From bc5dd628d0f5a04d87bf81472156f8cfa45c04a5 Mon Sep 17 00:00:00 2001
From: James Conkling <james.lane.conkling@gmail.com>
Date: Tue, 19 Jul 2016 10:59:14 -0400
Subject: [PATCH 1/4] build images

---
 Gruntfile.js                   |   4 +++-
 dist/images/spritesheet-2x.png | Bin 0 -> 2582 bytes
 dist/images/spritesheet.png    | Bin 0 -> 1539 bytes
 3 files changed, 3 insertions(+), 1 deletion(-)
 create mode 100644 dist/images/spritesheet-2x.png
 create mode 100644 dist/images/spritesheet.png

diff --git a/Gruntfile.js b/Gruntfile.js
index b458ca6..67e5775 100644
--- a/Gruntfile.js
+++ b/Gruntfile.js
@@ -21,7 +21,9 @@ module.exports = function(grunt){
     copy: {
       main: {
         files: [
-          { src: './src/leaflet.buffer-src.js', dest: './dist/leaflet.buffer.js' }
+          { src: './src/leaflet.buffer-src.js', dest: './dist/leaflet.buffer.js' },
+          { src: './src/images/spritesheet.png', dest: './dist/images/spritesheet.png' },
+          { src: './src/images/spritesheet-2x.png', dest: './dist/images/spritesheet-2x.png' }
         ]
       }
     },
diff --git a/dist/images/spritesheet-2x.png b/dist/images/spritesheet-2x.png
new file mode 100644
index 0000000000000000000000000000000000000000..797d5871381d8c031dcf63e1c8fc608477836f65
GIT binary patch
literal 2582
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

literal 0
HcmV?d00001

diff --git a/dist/images/spritesheet.png b/dist/images/spritesheet.png
new file mode 100644
index 0000000000000000000000000000000000000000..e7d6e5c85157fe1c66ea3ce6d3a5c85dcaaa8837
GIT binary patch
literal 1539
zcmaKs`#Tc~7{}L8DvRba$z?7vQjU)BByyRW9cdd6j$2wWEaZMU4yF#~lEui~++yx2
zmg{m4b4i+8ERJI3QpjA^c6R=Op67ku=ktAk`Tp{LzeJSH4bTa>6951JWQBlZ0DvP%
z0V|3g6>OxL0}22T8M1<#*@e%p=jm9xSji8ZmX^+oHFdw}jY&5O7*s~sxb$4mj)98+
z(P%WmFaX;}Op-irV@Cq{W(lE*UfsvRqKjik?V(y)_E7yYO$1z|1W5Q8&GL-r9$abj
zH!z?NtbgU?akmym+Zq121qP1So<lg2R08|u@Mu~x$)z&vQ3fN0cp2OrHMKuKJq=r1
zTTAJ+ahQ-dGBot^nq#qUdxC}$l`d5!sb}=ai)=PK#uJAt8v5DcFMP@(eMN;)Vr{h7
zp<|-dRWD76e8No=8RR!P&Om+1zP6b`XF~Sslr_Iykx6XA_5_B7(O_)-fDn$y>xtEl
z0;@k4UN7@DO}SM`e2L-u<rV9-{uzhpuRjh12NHWYBv$(n329lBQJcR@SWbPx!H#JY
zasV+JFIJ^UtSPL6)>zT@1rH<KzGB}%$zF%`UhQy<oUV`cIjb1wsHK9!^K&8%^D$1{
zd{c$Q@1v5XZ`8Nu7CDVagrAlXIwg&!)Is5jWAciMCS(=_I|be~+=4Y~db>3rDg*^n
zp?ls~>{8pktKAYSMaiN=V-n={DDdHs&i}eCS&=WCsjUtZB5{H8U{0Gq>UkHde+A<C
zRuj=$D@9MXC+(QXt1<gbS{r0|&i4_mkwLY}nsgSBQRh}G^mxM<qLTT29br6z4SO_U
zdKRdzx0H4qm8Afued0YWEiK(NHsn|98yF;TMK6s2-e*&Gpk(}oZ#?`#PBz63S|hR~
zpc>`lha)$q;xEN6r}|7nw${WW0Ozi!yDoFIcFD2@sY+JJLLO#ORWS?9yLu^GH@!VK
zKc7o=?FfwKGrW8!f@?8Qy;BI}zb^H5S{(CtzK|Fqi;2%*;xo%J-j-j+gjza*qMr^h
zee>}xID3`2KuZeWbZdL4YpeWArC-lCvBD9l^j8LjeidDJYglH)Q~f=~C+RvW^x+#O
z>uQg5tF~<)Jp7a!Rsdx`n-h8X_Ws+OFNPKB&{G?~VTD99-m!(%bm!d?K}fnjo2fSE
zI>PiU*RIBV*1$gWgQv~l-shszE2^f6WH$6V^VN-MS8H0S#f0>l6O9y{+BUvPfjb!o
zi>1EV46-TziLcbg9`2~p^bpv4kiV8UOlJ^nPO;!A8&dB}=M9!@Y~z#A%bxx2s|!xC
z_f|VMmD$fc#v)_;EftxtO)%N96~(3j{z%c*1v!|o9OE!i-0VkXO6<?lWI#!L8J_WD
zdRzte`%w=WQZNW|a<BGcaX|ht6n3AIfZlm#R+y(5Q9u(e--KON3vqmGHZxALyVC+Z
zXYwJjpo+@zUKL8~nru^7-L<{;qyO(!p<B1jG5dJ}-}-F;a)nksT5P9fOf0~a%@n8H
z!uk&&<G@PfhKBku-DL&xv_{T{^EnVybdXZeWMMZ0N{yng1MSDQfyfT~X>VcQrUW~#
z|1s`j2me00e^nMEH}|fcfRX!}L5}B{h*Kt=W6YKOB(l18DL&9npGISZzxsd-g&_7%
zQ{zSVCK3eI+SJ<j+A|0=c)EJ)`mCP?eRn_MH2Envv`qg{cI88)X0ru|V+5l$H^-OX
zaa-&Kbw(xZ>LSDYx`H*u1<#qEn;R)xi7#cI9eo~g?F^kpGw^9#bSZLd09fdh%BPq<
zAfs#Is1a*FGa@@0@<4;ncT<|Fa2@WB6h1v$4i^w5X{#I-{&5!jvW_b?aYfB^qC_<q
z+HR*2U_P~q4|Ply)}Gfdrrfb@?c0Th0V`%U<j#^Y{VON3stGgQxk=Xq84VIQlXnp7
zt*5G{;MB((fEKf`WBjfq;ZyIM8Jo@_=7fXG3&pB(`a>)fvm$WkO=HhscEHJ^`TS90
hgjT|@8*?auClWzSrG`4rjSI>hU}b3ouQPX#`wzKy0DAxc

literal 0
HcmV?d00001


From 92568428c539f9fef4860b3f54cf15b397d5f539 Mon Sep 17 00:00:00 2001
From: James Conkling <james.lane.conkling@gmail.com>
Date: Tue, 19 Jul 2016 15:16:19 -0400
Subject: [PATCH 2/4] don't throw error when plugin is loaded without being
 configured

---
 src/leaflet.buffer-src.js | 55 ++++++++++++++++++++++++++++-------------------
 1 file changed, 33 insertions(+), 22 deletions(-)

diff --git a/src/leaflet.buffer-src.js b/src/leaflet.buffer-src.js
index a7e69d1..292d73b 100644
--- a/src/leaflet.buffer-src.js
+++ b/src/leaflet.buffer-src.js
@@ -46,25 +46,36 @@
 
   var getModeHandlers = L.EditToolbar.prototype.getModeHandlers;
   L.EditToolbar.prototype.getModeHandlers = function(map){
-    var options = this.options.buffer;
-    if( options ){
-      options.featureGroup = this.options.featureGroup;
-      if( !( 'replace_polylines' in options ) ){
-        options.replace_polylines = true;
-      }
-      if( !( 'buffer_style' in options ) ){
-        options.buffer_style = {
-          fill: true,
-          dashArray: '1, 10'
-        };
-      }
-      if( !( 'separate_buffer' in options ) ){
-        options.separate_buffer = false;
-      }
+    var modeHandlers = getModeHandlers.call(this, map);
+
+    var bufferOptions = this.options.buffer;
+
+    if (!bufferOptions) {
+      return modeHandlers;
+    }
+
+    if (typeof bufferOptions === 'boolean') {
+      bufferOptions = {};
     }
-    return getModeHandlers.call(this, map).concat([{
-      enabled: options,
-      handler: new L.EditToolbar.Buffer(map, options)
+
+    bufferOptions.featureGroup = this.options.featureGroup;
+
+    if( !( 'replace_polylines' in bufferOptions ) ){
+      bufferOptions.replace_polylines = true;
+    }
+    if( !( 'buffer_style' in bufferOptions ) ){
+      bufferOptions.buffer_style = {
+        fill: true,
+        dashArray: '1, 10'
+      };
+    }
+    if( !( 'separate_buffer' in bufferOptions ) ){
+      bufferOptions.separate_buffer = false;
+    }
+
+    return modeHandlers.concat([{
+      enabled: bufferOptions,
+      handler: new L.EditToolbar.Buffer(map, bufferOptions)
     }]);
   };
   var _checkDisabled = L.EditToolbar.prototype._checkDisabled;
@@ -270,7 +281,7 @@
       var layer = e.layer || e.target || e;
       var layerIsPolygon = layer instanceof L.Polygon;
       var layerid = L.Util.stamp(layer);
-      if( ( layer instanceof L.Polyline && !layerIsPolygon ) || 
+      if( ( layer instanceof L.Polyline && !layerIsPolygon ) ||
           ( this._separate_buffer && !(layerid in this._originalLayers) ) ){
 
         var newGeo = this._buffer(layer.toGeoJSON(), 0.00001);
@@ -279,7 +290,7 @@
         this._originalLayers[newLayerId] = layer;
         layer.setStyle(this._buffer_style);
         if( this._replace_polyline && !layerIsPolygon ){
-          this._featureGroup.removeLayer(temp);
+          this._featureGroup.removeLayer(layer);
         }
         this._featureGroup.addLayer(layer);
       }
@@ -303,7 +314,7 @@
             orig_geoJSON: layer.toGeoJSON()
           };
         }
-      } 
+      }
       var centroid = layer.getCentroid();
       this._bufferData[this._draggingLayerId].centroid = centroid;
       this._bufferData[this._draggingLayerId].orig_distanceToCenter =
@@ -363,7 +374,7 @@
     _hasAvailableLayers: function () {
       return this._featureGroup.getLayers().length !== 0;
     },
-    
+
     _setTooltip: function(radiusOrMessage){
       var message;
       if( typeof radiusOrMessage === 'string' ){

From dd92428a46695a49d4557030f39a3669db625865 Mon Sep 17 00:00:00 2001
From: James Conkling <james.lane.conkling@gmail.com>
Date: Tue, 19 Jul 2016 15:17:17 -0400
Subject: [PATCH 3/4] build as umd package

---
 Gruntfile.js | 15 ++++++++++++++-
 package.json |  1 +
 2 files changed, 15 insertions(+), 1 deletion(-)

diff --git a/Gruntfile.js b/Gruntfile.js
index 67e5775..de7262a 100644
--- a/Gruntfile.js
+++ b/Gruntfile.js
@@ -5,8 +5,21 @@ module.exports = function(grunt){
   };
   require('load-grunt-tasks')(grunt);
 
+  grunt.loadNpmTasks('grunt-umd');
+
 
   grunt.initConfig({
+    umd: {
+      all: {
+        options: {
+          src: 'src/leaflet.buffer-src.js',
+          dest: 'dist/leaflet.buffer.js', // optional, if missing the src will be used
+          deps: {
+            'default': ['jsts']
+          }
+        }
+      }
+    },
     clean: {
       dist: ['dist'],
       instrumented: ['instrumented']
@@ -122,7 +135,7 @@ module.exports = function(grunt){
   grunt.registerTask('build', [
     'clean',
     'uglify:min',
-    'copy',
+    'umd:all',
     'cssmin:min',
   ]);
 };
diff --git a/package.json b/package.json
index 569f641..b71a6f1 100644
--- a/package.json
+++ b/package.json
@@ -35,6 +35,7 @@
     "grunt-istanbul": "^0.3.0",
     "grunt-protractor-coverage": "^0.2.10",
     "grunt-selenium-webdriver": "^0.2.422",
+    "grunt-umd": "^2.3.6",
     "load-grunt-tasks": "^0.6.0",
     "mocha": "^1.21.4",
     "protractor": "^1.2.0"

From 010d946263e20065b239b1a658065ba49dd50a43 Mon Sep 17 00:00:00 2001
From: James Conkling <james.lane.conkling@gmail.com>
Date: Tue, 19 Jul 2016 15:18:42 -0400
Subject: [PATCH 4/4] rebuild

---
 Gruntfile.js               |  2 +-
 dist/leaflet.buffer.js     | 74 ++++++++++++++++++++++++++++++++--------------
 dist/leaflet.buffer.min.js |  2 +-
 3 files changed, 54 insertions(+), 24 deletions(-)

diff --git a/Gruntfile.js b/Gruntfile.js
index de7262a..1ebc1a3 100644
--- a/Gruntfile.js
+++ b/Gruntfile.js
@@ -34,7 +34,6 @@ module.exports = function(grunt){
     copy: {
       main: {
         files: [
-          { src: './src/leaflet.buffer-src.js', dest: './dist/leaflet.buffer.js' },
           { src: './src/images/spritesheet.png', dest: './dist/images/spritesheet.png' },
           { src: './src/images/spritesheet-2x.png', dest: './dist/images/spritesheet-2x.png' }
         ]
@@ -135,6 +134,7 @@ module.exports = function(grunt){
   grunt.registerTask('build', [
     'clean',
     'uglify:min',
+    'copy',
     'umd:all',
     'cssmin:min',
   ]);
diff --git a/dist/leaflet.buffer.js b/dist/leaflet.buffer.js
index a7e69d1..751714a 100644
--- a/dist/leaflet.buffer.js
+++ b/dist/leaflet.buffer.js
@@ -1,3 +1,19 @@
+(function (root, factory) {
+  if (typeof define === 'function' && define.amd) {
+    // AMD. Register as an anonymous module unless amdModuleId is set
+    define(["jsts"], function (a0) {
+      return (factory(a0));
+    });
+  } else if (typeof exports === 'object') {
+    // Node. Does not work with strict CommonJS, but
+    // only CommonJS-like environments that support module.exports,
+    // like Node.
+    module.exports = factory(require("jsts"));
+  } else {
+    factory(jsts);
+  }
+}(this, function (jsts) {
+
 /*
  * Leaflet.buffer
  *
@@ -46,25 +62,36 @@
 
   var getModeHandlers = L.EditToolbar.prototype.getModeHandlers;
   L.EditToolbar.prototype.getModeHandlers = function(map){
-    var options = this.options.buffer;
-    if( options ){
-      options.featureGroup = this.options.featureGroup;
-      if( !( 'replace_polylines' in options ) ){
-        options.replace_polylines = true;
-      }
-      if( !( 'buffer_style' in options ) ){
-        options.buffer_style = {
-          fill: true,
-          dashArray: '1, 10'
-        };
-      }
-      if( !( 'separate_buffer' in options ) ){
-        options.separate_buffer = false;
-      }
+    var modeHandlers = getModeHandlers.call(this, map);
+
+    var bufferOptions = this.options.buffer;
+
+    if (!bufferOptions) {
+      return modeHandlers;
     }
-    return getModeHandlers.call(this, map).concat([{
-      enabled: options,
-      handler: new L.EditToolbar.Buffer(map, options)
+
+    if (typeof bufferOptions === 'boolean') {
+      bufferOptions = {};
+    }
+
+    bufferOptions.featureGroup = this.options.featureGroup;
+
+    if( !( 'replace_polylines' in bufferOptions ) ){
+      bufferOptions.replace_polylines = true;
+    }
+    if( !( 'buffer_style' in bufferOptions ) ){
+      bufferOptions.buffer_style = {
+        fill: true,
+        dashArray: '1, 10'
+      };
+    }
+    if( !( 'separate_buffer' in bufferOptions ) ){
+      bufferOptions.separate_buffer = false;
+    }
+
+    return modeHandlers.concat([{
+      enabled: bufferOptions,
+      handler: new L.EditToolbar.Buffer(map, bufferOptions)
     }]);
   };
   var _checkDisabled = L.EditToolbar.prototype._checkDisabled;
@@ -270,7 +297,7 @@
       var layer = e.layer || e.target || e;
       var layerIsPolygon = layer instanceof L.Polygon;
       var layerid = L.Util.stamp(layer);
-      if( ( layer instanceof L.Polyline && !layerIsPolygon ) || 
+      if( ( layer instanceof L.Polyline && !layerIsPolygon ) ||
           ( this._separate_buffer && !(layerid in this._originalLayers) ) ){
 
         var newGeo = this._buffer(layer.toGeoJSON(), 0.00001);
@@ -279,7 +306,7 @@
         this._originalLayers[newLayerId] = layer;
         layer.setStyle(this._buffer_style);
         if( this._replace_polyline && !layerIsPolygon ){
-          this._featureGroup.removeLayer(temp);
+          this._featureGroup.removeLayer(layer);
         }
         this._featureGroup.addLayer(layer);
       }
@@ -303,7 +330,7 @@
             orig_geoJSON: layer.toGeoJSON()
           };
         }
-      } 
+      }
       var centroid = layer.getCentroid();
       this._bufferData[this._draggingLayerId].centroid = centroid;
       this._bufferData[this._draggingLayerId].orig_distanceToCenter =
@@ -363,7 +390,7 @@
     _hasAvailableLayers: function () {
       return this._featureGroup.getLayers().length !== 0;
     },
-    
+
     _setTooltip: function(radiusOrMessage){
       var message;
       if( typeof radiusOrMessage === 'string' ){
@@ -394,3 +421,6 @@
     }
   });
 })(window, document);
+
+
+}));
diff --git a/dist/leaflet.buffer.min.js b/dist/leaflet.buffer.min.js
index b933dca..d5c8b16 100644
--- a/dist/leaflet.buffer.min.js
+++ b/dist/leaflet.buffer.min.js
@@ -1 +1 @@
-!function(a,b){function c(a){return L.latLng(a[1],a[0])}L.bufferVersion="0.1.2",L.Polygon.include({getCentroid:function(a){return a=a||this.getLatLngs(),a[0]instanceof Array?this.getCentroid(a.map(this.getCentroid)):a.reduce(function(a,b){return a.count++,a.latSum+=b.lat,a.lngSum+=b.lng,a.avg=L.latLng(a.latSum/a.count,a.lngSum/a.count),a},{count:0,latSum:0,lngSum:0}).avg}}),L.Circle.include({getCentroid:function(){return this.getLatLng()}}),L.drawLocal.edit.toolbar.buttons.buffer="Expand layers.",L.drawLocal.edit.toolbar.buttons.bufferDisabled="No layers to expand.",L.drawLocal.edit.handlers.buffer={tooltip:{text:"Click and drag to expand or contract a shape."}};var d=L.EditToolbar.prototype.getModeHandlers;L.EditToolbar.prototype.getModeHandlers=function(a){var b=this.options.buffer;return b&&(b.featureGroup=this.options.featureGroup,"replace_polylines"in b||(b.replace_polylines=!0),"buffer_style"in b||(b.buffer_style={fill:!0,dashArray:"1, 10"}),"separate_buffer"in b||(b.separate_buffer=!1)),d.call(this,a).concat([{enabled:b,handler:new L.EditToolbar.Buffer(a,b)}])};var e=L.EditToolbar.prototype._checkDisabled;L.EditToolbar.prototype._checkDisabled=function(){e.call(this);var a,b=this.options.featureGroup,c=0!==b.getLayers().length;this.options.buffer&&(a=this._modes[L.EditToolbar.Buffer.TYPE].button,c?L.DomUtil.removeClass(a,"leaflet-disabled"):L.DomUtil.addClass(a,"leaflet-disabled"),a.setAttribute("title",c?L.drawLocal.edit.toolbar.buttons.buffer:L.drawLocal.edit.toolbar.buttons.bufferDisabled))},L.EditToolbar.Buffer=L.Handler.extend({statics:{TYPE:"buffer"},includes:L.Mixin.Events,_draggingLayer:null,_originalLayers:{},_bufferData:{},initialize:function(a,b){if(L.Handler.prototype.initialize.call(this,a),this._selectedPathOptions=b.selectedPathOptions,this._featureGroup=b.featureGroup,this._replace_polyline=b.replace_polylines,this._separate_buffer=b.separate_buffer,this._buffer_style=b.buffer_style,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._unbufferedLayerProps={},this.type=L.EditToolbar.Buffer.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:bufferstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerBuffer,this).on("layerremove",this._disableLayerBuffer,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerBuffer,this).off("layerremove",this._disableLayerBuffer,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:bufferstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerBuffer,this),this._tooltip=new L.Tooltip(this._map),this._setTooltip(L.drawLocal.edit.handlers.buffer.tooltip.text),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerBuffer,this),this._unbufferedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){var a=new L.LayerGroup,b=new L.LayerGroup;this._featureGroup.eachLayer(function(c){var d=this._originalLayers[L.Util.stamp(c)];c.buffered&&(a.addLayer(c),c.buffered=!1),d&&(this._map.fire("draw:created",{layer:c}),this._replace_polyline&&b.addLayer(d))}.bind(this)),this._originalLayers={},this._map.fire("draw:buffered",{layers:a}),this._map.fire("draw:deleted",{layers:b})},_backupLayer:function(a){var b=L.Util.stamp(a);this._unbufferedLayerProps[b]||(a instanceof L.Polygon||a instanceof L.Rectangle?this._unbufferedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle&&(this._unbufferedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}))},_revertLayer:function(a){var b=L.Util.stamp(a);a.buffered=!1,b in this._originalLayers?(this._featureGroup.addLayer(this._originalLayers[b]),this._featureGroup.removeLayer(a),delete this._originalLayers[b]):this._unbufferedLayerProps.hasOwnProperty(b)?a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._unbufferedLayerProps[b].latlngs):a instanceof L.Circle&&(a.setLatLng(this._unbufferedLayerProps[b].latlng),a.setRadius(this._unbufferedLayerProps[b].radius)):a instanceof L.Polygon&&this._map.removeLayer(a)},_enableLayerBuffer:function(a){var b=a.layer||a.target||a;b instanceof L.Marker||(this._backupLayer(b),b.buffered=!0,b.on("mousedown",this._onLayerDragStart,this),this._map.on("mouseup",this._onLayerDragEnd,this))},_disableLayerBuffer:function(a){var b=a.layer||a.target||a;b.buffered=!1,this._bufferData={},b.off("mousedown",this._onLayerDragStart,this),this._map.off("mouseup",this._onLayerDragEnd,this)},_onLayerDragStart:function(a){var b=a.layer||a.target||a,d=b instanceof L.Polygon,e=L.Util.stamp(b);if(b instanceof L.Polyline&&!d||this._separate_buffer&&!(e in this._originalLayers)){var f=this._buffer(b.toGeoJSON(),1e-5);b=new L.Polygon(f.coordinates[0].map(c));var g=L.Util.stamp(b);this._originalLayers[g]=b,b.setStyle(this._buffer_style),this._replace_polyline&&!d&&this._featureGroup.removeLayer(temp),this._featureGroup.addLayer(b)}this._map.on("mousemove",this._onLayerDrag,this),this._draggingLayer=b,this._draggingLayerId=L.Util.stamp(b),this._draggingLayerId in this._bufferData||(b instanceof L.Circle?this._bufferData[this._draggingLayerId]={radius:b.getRadius(),temp_radius:0,orig_geoJSON:b.toGeoJSON()}:this._bufferData[this._draggingLayerId]={size:0,temp_size:0,radius:0,temp_radius:0,orig_geoJSON:b.toGeoJSON()});var h=b.getCentroid();this._bufferData[this._draggingLayerId].centroid=h,this._bufferData[this._draggingLayerId].orig_distanceToCenter=a.latlng.distanceTo(this._bufferData[this._draggingLayerId].centroid),this._setTooltip(this._bufferData[this._draggingLayerId].radius)},_onLayerDrag:function(a){a.originalEvent.stopPropagation();var b=this._bufferData[this._draggingLayerId],d=b.centroid.distanceTo(a.latlng)-b.orig_distanceToCenter;if(b.temp_radius=b.radius+d,this._setTooltip(b.temp_radius),this._draggingLayer instanceof L.Circle)this._draggingLayer.setRadius(b.temp_radius);else{d/=111120,b.temp_size=b.size+d;var e=this._buffer(b.orig_geoJSON,b.temp_size);"MultiPolygon"!==e.type&&this._draggingLayer.setLatLngs(e.coordinates[0].map(c))}},_onLayerDragEnd:function(a){var b=this._bufferData[this._draggingLayerId];b&&(b.size=b.temp_size,b.radius=b.temp_radius),this._map.off("mousemove",this._onLayerDrag,this),this._draggingLayer=null,this._setTooltip(L.drawLocal.edit.handlers.buffer.tooltip.text)},_onMarkerDragEnd:function(a){var b=a.target;b.edited=!0},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length},_setTooltip:function(a){var b;if("string"==typeof a)b=a;else{var c=a,d=c/1e3,e=3.28084*c,f=e/5280,g=d>=1?"km":"m",h=(d>=1?d:c).toFixed(2),i=f>=.1?"mi":"ft",j=(f>=.1?f:e).toFixed(2);b="Buffer radius: ",b+=h+g+" ",b+=j+i+" "}this._tooltip.updateContent({text:b})},_buffer:function(a,b){var c=new jsts.io.GeoJSONReader,d=new jsts.io.GeoJSONWriter,e=c.read(a).geometry.buffer(b);return d.write(e)}})}(window,document);
\ No newline at end of file
+!function(a,b){function c(a){return L.latLng(a[1],a[0])}L.bufferVersion="0.1.2",L.Polygon.include({getCentroid:function(a){return a=a||this.getLatLngs(),a[0]instanceof Array?this.getCentroid(a.map(this.getCentroid)):a.reduce(function(a,b){return a.count++,a.latSum+=b.lat,a.lngSum+=b.lng,a.avg=L.latLng(a.latSum/a.count,a.lngSum/a.count),a},{count:0,latSum:0,lngSum:0}).avg}}),L.Circle.include({getCentroid:function(){return this.getLatLng()}}),L.drawLocal.edit.toolbar.buttons.buffer="Expand layers.",L.drawLocal.edit.toolbar.buttons.bufferDisabled="No layers to expand.",L.drawLocal.edit.handlers.buffer={tooltip:{text:"Click and drag to expand or contract a shape."}};var d=L.EditToolbar.prototype.getModeHandlers;L.EditToolbar.prototype.getModeHandlers=function(a){var b=d.call(this,a),c=this.options.buffer;return c?("boolean"==typeof c&&(c={}),c.featureGroup=this.options.featureGroup,"replace_polylines"in c||(c.replace_polylines=!0),"buffer_style"in c||(c.buffer_style={fill:!0,dashArray:"1, 10"}),"separate_buffer"in c||(c.separate_buffer=!1),b.concat([{enabled:c,handler:new L.EditToolbar.Buffer(a,c)}])):b};var e=L.EditToolbar.prototype._checkDisabled;L.EditToolbar.prototype._checkDisabled=function(){e.call(this);var a,b=this.options.featureGroup,c=0!==b.getLayers().length;this.options.buffer&&(a=this._modes[L.EditToolbar.Buffer.TYPE].button,c?L.DomUtil.removeClass(a,"leaflet-disabled"):L.DomUtil.addClass(a,"leaflet-disabled"),a.setAttribute("title",c?L.drawLocal.edit.toolbar.buttons.buffer:L.drawLocal.edit.toolbar.buttons.bufferDisabled))},L.EditToolbar.Buffer=L.Handler.extend({statics:{TYPE:"buffer"},includes:L.Mixin.Events,_draggingLayer:null,_originalLayers:{},_bufferData:{},initialize:function(a,b){if(L.Handler.prototype.initialize.call(this,a),this._selectedPathOptions=b.selectedPathOptions,this._featureGroup=b.featureGroup,this._replace_polyline=b.replace_polylines,this._separate_buffer=b.separate_buffer,this._buffer_style=b.buffer_style,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._unbufferedLayerProps={},this.type=L.EditToolbar.Buffer.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:bufferstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerBuffer,this).on("layerremove",this._disableLayerBuffer,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerBuffer,this).off("layerremove",this._disableLayerBuffer,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:bufferstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerBuffer,this),this._tooltip=new L.Tooltip(this._map),this._setTooltip(L.drawLocal.edit.handlers.buffer.tooltip.text),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerBuffer,this),this._unbufferedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){var a=new L.LayerGroup,b=new L.LayerGroup;this._featureGroup.eachLayer(function(c){var d=this._originalLayers[L.Util.stamp(c)];c.buffered&&(a.addLayer(c),c.buffered=!1),d&&(this._map.fire("draw:created",{layer:c}),this._replace_polyline&&b.addLayer(d))}.bind(this)),this._originalLayers={},this._map.fire("draw:buffered",{layers:a}),this._map.fire("draw:deleted",{layers:b})},_backupLayer:function(a){var b=L.Util.stamp(a);this._unbufferedLayerProps[b]||(a instanceof L.Polygon||a instanceof L.Rectangle?this._unbufferedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle&&(this._unbufferedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}))},_revertLayer:function(a){var b=L.Util.stamp(a);a.buffered=!1,b in this._originalLayers?(this._featureGroup.addLayer(this._originalLayers[b]),this._featureGroup.removeLayer(a),delete this._originalLayers[b]):this._unbufferedLayerProps.hasOwnProperty(b)?a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._unbufferedLayerProps[b].latlngs):a instanceof L.Circle&&(a.setLatLng(this._unbufferedLayerProps[b].latlng),a.setRadius(this._unbufferedLayerProps[b].radius)):a instanceof L.Polygon&&this._map.removeLayer(a)},_enableLayerBuffer:function(a){var b=a.layer||a.target||a;b instanceof L.Marker||(this._backupLayer(b),b.buffered=!0,b.on("mousedown",this._onLayerDragStart,this),this._map.on("mouseup",this._onLayerDragEnd,this))},_disableLayerBuffer:function(a){var b=a.layer||a.target||a;b.buffered=!1,this._bufferData={},b.off("mousedown",this._onLayerDragStart,this),this._map.off("mouseup",this._onLayerDragEnd,this)},_onLayerDragStart:function(a){var b=a.layer||a.target||a,d=b instanceof L.Polygon,e=L.Util.stamp(b);if(b instanceof L.Polyline&&!d||this._separate_buffer&&!(e in this._originalLayers)){var f=this._buffer(b.toGeoJSON(),1e-5);b=new L.Polygon(f.coordinates[0].map(c));var g=L.Util.stamp(b);this._originalLayers[g]=b,b.setStyle(this._buffer_style),this._replace_polyline&&!d&&this._featureGroup.removeLayer(b),this._featureGroup.addLayer(b)}this._map.on("mousemove",this._onLayerDrag,this),this._draggingLayer=b,this._draggingLayerId=L.Util.stamp(b),this._draggingLayerId in this._bufferData||(b instanceof L.Circle?this._bufferData[this._draggingLayerId]={radius:b.getRadius(),temp_radius:0,orig_geoJSON:b.toGeoJSON()}:this._bufferData[this._draggingLayerId]={size:0,temp_size:0,radius:0,temp_radius:0,orig_geoJSON:b.toGeoJSON()});var h=b.getCentroid();this._bufferData[this._draggingLayerId].centroid=h,this._bufferData[this._draggingLayerId].orig_distanceToCenter=a.latlng.distanceTo(this._bufferData[this._draggingLayerId].centroid),this._setTooltip(this._bufferData[this._draggingLayerId].radius)},_onLayerDrag:function(a){a.originalEvent.stopPropagation();var b=this._bufferData[this._draggingLayerId],d=b.centroid.distanceTo(a.latlng)-b.orig_distanceToCenter;if(b.temp_radius=b.radius+d,this._setTooltip(b.temp_radius),this._draggingLayer instanceof L.Circle)this._draggingLayer.setRadius(b.temp_radius);else{d/=111120,b.temp_size=b.size+d;var e=this._buffer(b.orig_geoJSON,b.temp_size);"MultiPolygon"!==e.type&&this._draggingLayer.setLatLngs(e.coordinates[0].map(c))}},_onLayerDragEnd:function(a){var b=this._bufferData[this._draggingLayerId];b&&(b.size=b.temp_size,b.radius=b.temp_radius),this._map.off("mousemove",this._onLayerDrag,this),this._draggingLayer=null,this._setTooltip(L.drawLocal.edit.handlers.buffer.tooltip.text)},_onMarkerDragEnd:function(a){var b=a.target;b.edited=!0},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length},_setTooltip:function(a){var b;if("string"==typeof a)b=a;else{var c=a,d=c/1e3,e=3.28084*c,f=e/5280,g=d>=1?"km":"m",h=(d>=1?d:c).toFixed(2),i=f>=.1?"mi":"ft",j=(f>=.1?f:e).toFixed(2);b="Buffer radius: ",b+=h+g+" ",b+=j+i+" "}this._tooltip.updateContent({text:b})},_buffer:function(a,b){var c=new jsts.io.GeoJSONReader,d=new jsts.io.GeoJSONWriter,e=c.read(a).geometry.buffer(b);return d.write(e)}})}(window,document);
\ No newline at end of file
